<!doctype html>
<html>
    <head>
        <title>Online Mahjong</title>
        <link rel="icon" type="image/png" href="/favicon.png"/>
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
        <!-- <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet"> -->
        <link href="https://fonts.googleapis.com/css?family=Material+Icons" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
        <link rel="stylesheet" href="main.css">

    </head>
    <body>
        <div id="app" v-cloak>
            <v-app>
                <v-main>
                    <v-app-bar
                        color="deep-purple" dark>

                        <v-app-bar-nav-icon @click="navDrawer = true"></v-app-bar-nav-icon>
                        <img src="res/bamboo_1.png" @click="navDrawer = true">
                        <v-toolbar-title>Online Mahjong</v-toolbar-title>
                        <v-row justify="end">
                            <v-icon v-if=!signedIn>
                                person_outline
                            </v-icon>
                            <span v-if="signedIn">
                                <v-menu offset-y>
                                    <template v-slot:activator="{ on, attrs }">
                                      <v-col
                                        class="height100"
                                        color="primary"
                                        dark
                                        v-bind="attrs"
                                        v-on="on"

                                      >
                                        <v-icon>
                                            person
                                        </v-icon>
                                        <span>
                                            {{username}}
                                        </span>
                                        <v-icon>
                                            expand_more
                                        </v-icon>
                                      </v-div>

                                    </template>
                                    <v-list>
                                      <v-list-item @click="signOut()">
                                        <v-list-item-title>Sign Out</v-list-item-title>
                                      </v-list-item>
                                    </v-list>
                                  </v-menu>
                            </span>
                        </v-row>
                    </v-app-bar>

                    <v-navigation-drawer
                    v-model="navDrawer"
                    absolute
                    temporary
                    >
                        <v-list
                        nav
                        dense
                        >
                        <v-list-item-group
                            v-model="group"
                            active-class="deep-purple--text text--accent-4"
                        >
                            <v-list-item>
                            <v-list-item-icon>
                                <v-icon>mdi-home</v-icon>
                            </v-list-item-icon>
                            <v-list-item-title>Home</v-list-item-title>
                            </v-list-item>
                
                            <v-list-item>
                            <v-list-item-icon>
                                <v-icon>mdi-account</v-icon>
                            </v-list-item-icon>
                            <v-list-item-title>Account</v-list-item-title>
                            </v-list-item>
                        </v-list-item-group>
                        </v-list>
                    </v-navigation-drawer>

                    <div v-if="loadingData && !errored">
                        Loading...
                    </div>
                    <div v-if="errored">
                        Something went wrong, please try again.
                    </div>
                    <div v-if="!loadingData && !errored">
                        <v-form v-if="!signedIn">
                            <v-container fluid class="signin-container">
                                <!-- <div class="signin-title">
                                    <img src="res/bamboo_1.png"><span>Online Mahjong</span>
                                </div> -->
                                <v-row>
                                    <v-col>
                                        <div >
                                            <v-text-field label="Username"
                                                v-model="promptUsername" outlined>
                                            </v-text-field>
                                        </div>
                                    </v-col>
                                </v-row>
                                <v-row>
                                    <v-col>
                                        
                                            <v-text-field
                                            v-model="password"
                                            :append-icon="showPassword ? 'mdi-eye' : 'mdi-eye-off'"
                                    
                                            :type="showPassword ? 'text' : 'password'"
                                    
                                            label="Password"
                                            hint="At least 8 characters"
                                            counter
                                            @click:append="showPassword = !showPassword" outlined>
                                            <!--
                                            :rules="[rules.required, rules.min]"
                                            name="input-10-1"
                                            -->
                                        </v-text-field>
                                        
                                    </v-col>
                                </v-row>
                                <v-row>
                                    <v-col>
                                        <v-row justify="center">
                                            <v-btn v-on:click="signIn()" color="light-blue">Sign In</v-btn>
                                        </v-row>
                                        
                                    </v-col>
                                    <v-col>
                                        <v-row justify="center">
                                            <v-btn v-on:click="signUp()" color="deep-purple">Create Account</v-btn>
                                        </v-row>
                                    </v-col>
                                </v-row>
                            </v-container>
                        </v-form>


                        <v-container fluid class="maingame-container">
                            <div v-if="signedIn">
                                <div v-if="!joined">
                                    <v-btn v-on:click="createGame()">Create Game</v-btn>
                                    <!-- <v-btn v-on:click="createGame(true)">Create Private Game</v-btn> -->
                                    <v-btn v-on:click="joinGame()">Join Game</v-btn>
                                    <v-text-field label="Enter GameID"
                                        v-model="joinGameInputField" outlined>
                                    </v-text-field>
                                </div>
                                <div id="main-game" v-if="joined">
                                    <span>Game ID: <b>{{ currentGameId }}</b></span>
                                    <br>
                                    <v-progress-circular
                                        indeterminate
                                        color="primary"
                                        v-if="waitingForPlayers"
                                        >
                                    </v-progress-circular>
                                    <span>{{ status }} <img v-if="activeTile"  v-bind:src="'res/' + activeTile + '.png'"></img></span>
                                    <h2>Other Players: </h2>
                                    <div id="other-player-section">
                                        <div id="other-player-stub" v-for="player in players" v-bind:class="activePlayer(player)">
                                            <span v-if="player.playerIdentifier == username">[You]</span><b>{{ player.playerIdentifier }}</b>
                                            <span v-for="set in player.visibleTiles">
                                                <img v-for="tile in set" v-bind:src="'res/' + tile + '.png'">
                                            </span>
                                        </div>
                                    </div>
                                    <h2>
                                        Your Hand
                                    </h2>
                                    <draggable v-model="myTiles" group="people" @start="drag=true" @end="drag=false" @change="updateTileOrder()">
                                        <img v-for="tile in myTiles" v-bind:src="'res/' + tile + '.png'" v-on:click="clickTile(tile)">
                                        <!-- <v-btn slot="footer" @click="saveTilePositions()">Save Tile Position</v-btn> -->
                                    </draggable>
                                    <h2>
                                        Actively Selected Tiles
                                    </h2>
                                    <img v-for="tile in activeTiles" v-bind:src="'res/' + tile + '.png'" v-on:click="deselectTile(tile)">
                                    <div v-if="inCheckPhase && waitingForYourCheck">
                                        <v-btn v-on:click="sendEvent('Win')">
                                            Win (胡) literally win the game
                                        </v-btn>
                                        <v-btn v-on:click="sendEvent('Gang')">
                                            Gang (杠) Four of a kind
                                        </v-btn>
                                        <v-btn v-on:click="sendEvent('Match')">
                                            Match (碰) Three of a kind
                                        </v-btn>
                                        <v-btn v-on:click="sendEvent('Eat', activeTiles)">
                                            Eat (吃) Straight (can only eat person directly upstream of you)
                                        </v-btn>
                                        <v-btn v-on:click="sendEvent('Pass')">
                                            Pass (Do Nothing)
                                        </v-btn>
                                    </div>
                                </div>
                            </div>
                        </v-container>
                    </div>
                </v-main>
            </v-app>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>

        <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/vue/2.5.2/vue.min.js"></script> -->
        <!-- CDNJS :: Sortable (https://cdnjs.com/) -->
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
        <!-- CDNJS :: Vue.Draggable (https://cdnjs.com/) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.24.3/vuedraggable.umd.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

        <script src="index.js"></script>
    </body>
</html>
